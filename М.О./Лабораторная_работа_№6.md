# Лабораторная работа №6
# Назарова Дарья

Сначала скачала нужные библиотеки


```python
!pip install pymorphy2 # библиотека используется для морфологического анализа русского языка.

!pip install nltk # библиотека предоставляет инструменты для работы с естественным языком, включая токенизацию, стемминг и другие функции.

```

    Requirement already satisfied: pymorphy2 in /usr/local/lib/python3.10/dist-packages (0.9.1)
    Requirement already satisfied: dawg-python>=0.7.1 in /usr/local/lib/python3.10/dist-packages (from pymorphy2) (0.7.2)
    Requirement already satisfied: pymorphy2-dicts-ru<3.0,>=2.4 in /usr/local/lib/python3.10/dist-packages (from pymorphy2) (2.4.417127.4579844)
    Requirement already satisfied: docopt>=0.6 in /usr/local/lib/python3.10/dist-packages (from pymorphy2) (0.6.2)
    Requirement already satisfied: nltk in /usr/local/lib/python3.10/dist-packages (3.9.1)
    Requirement already satisfied: click in /usr/local/lib/python3.10/dist-packages (from nltk) (8.1.7)
    Requirement already satisfied: joblib in /usr/local/lib/python3.10/dist-packages (from nltk) (1.4.2)
    Requirement already satisfied: regex>=2021.8.3 in /usr/local/lib/python3.10/dist-packages (from nltk) (2024.9.11)
    Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (from nltk) (4.66.6)
    

Потом импортировала библиотеки


```python
import re  # модуль re для работы с регулярными выражениями.
import nltk  # библиотека nltk для работы с естественным языком.
from nltk.corpus import stopwords  # список стоп-слов из корпуса nltk.
from nltk.tokenize import word_tokenize  # функция для токенизации текста.
import pymorphy2  # pymorphy2 для морфологического анализа русского языка.
import string  # модуль string для работы с набором строковых констант.
nltk.download('punkt_tab')  # набор данных 'punkt_tab' для токенизации текста.

```

    [nltk_data] Downloading package punkt_tab to /root/nltk_data...
    [nltk_data]   Package punkt_tab is already up-to-date!
    




    True



Загрузила стоп-слова для русского языка


```python
nltk.download('stopwords')  # загрузка стоп-слов из библиотеки nltk.
russian_stopwords = set(stopwords.words('russian'))  # множество стоп-слов для русского языка.
```

    [nltk_data] Downloading package stopwords to /root/nltk_data...
    [nltk_data]   Package stopwords is already up-to-date!
    

Функция для предобработки текста: лемматизация и фильтрация стоп-слов


```python
def preprocess_text(text):
    morph = pymorphy2.MorphAnalyzer()  # Создаю экземпляр морфологического анализатора.

    text = re.sub(r'[^а-яё]', ' ', text.lower())  # заменила все символы, кроме букв, на пробелы и привела текст к нижнему регистру.

    words = text.split()  # Разбила текст на слова и удалила лишние пробелы.

    lemmatized_words = [
        morph.normal_forms(word)[0] for word in words  # Получается начальная форма слова.
        if word not in russian_stopwords and word.isalpha()  # Фильт стоп-слов, чтобы остались только буквы.
    ]

    return set(lemmatized_words)  # Возвращаем множество лемматизированных слов.

```

Добавление двух текстов


```python
news1 = 'Как сообщили «Ведомости», правительство внесло в Госдуму пакет поправок в законодательство по помощи регионам в связи с потерями, которые они несут из-за кризиса. Общая стоимость помощи — около 100 млрд рублей. Однако налоговые доходы регионов, по данным Минфина, могут снизиться в 2009 году на 700—800 млрд рублей. Доходы от налога на прибыль снизятся на 25—30%, от подоходного — на 5—10% . Еще около 100 млрд рублей регионы потеряют из-за налоговых нововведений — снижения налога на прибыль с 24 до 20%, увеличения предельной амортизационной премии с 10 до 30% (по 3—7-й амортизационным группам) и имущественного вычета при покупке квартиры с 1 млн до 2 млн рублей. \
Поправки передают регионам 0,5% налога на прибыль (их доля вырастет с 17,5 до 18%) и 100% акцизов на горюче-смазочные материалы (сейчас — 60%). Это пополнит региональные бюджеты на 43,1 млрд и 59,4 млрд рублей соответственно, говорится в пояснительной записке к законопроекту. Губернатор Пермского края Олег Чиркунов поддерживает передачу налогов, «но этих средств не хватит для восстановления предкризисного уровня». Бюджет края на следующий год уже пересмотрен, отметил Чиркунов: доходная часть снижена на 35%, половина этой суммы выпадает из-за снижения поступлений налога на прибыль. Директор Института региональных финансов Булат Столяров допускает, что выпадающие доходы регионов могут достигнуть 1,5 трлн рублей. В следующем году у предприятий прибыли почти не будет, говорит он, стоило бы передать регионам часть НДС, а не налога на прибыль. \
Кроме того, в ближайшее время будут подготовлены поправки в Бюджетный кодекс, разрешающие регионам предоставлять гарантии по банковским кредитам в размере 50— 70%, рассказал вице-премьер Алексей Кудрин. Однако реальная глубина кризиса, охватившего российские промышленные районы, непонятна до конца и правительству. Екатеринбургский сайт "Английское название" публикует сенсационные материалы о ситуации на уральских предприятиях, составленные профсоюзными организациями. Из них следует, что кризис ударил Свердловскую область под дых. \
Уже сейчас на предприятиях Среднего Урала тяжелейшая ситуация, но в январе всё будет еще хуже — большинство заводов-гигантов анонсируют новые сокращения заработной платы. До сегодняшнего дня экономический кризис на Урале не имел своего лица. Да, региональные власти раньше федеральных признали серьезные проблемы на заводах, но иначе и быть не могло — свердловское правительство физически ближе к директорам предприятий и рабочим металлургических предприятий, моментально почувствовавшим неладное. Впрочем, даже в этой ситуации уральские политики старались сохранить лицо, советуя перетерпеть и переждать. С таким подходом общей картины кризиса не было ни у кого: вот проблемы в банках, вот на УГМК продлили ноябрьские праздники, но в целом всё отлично и якобы все сокращения касаются только управленцев, простые люди не страдают. \
Но теперь ситуация иная. В распоряжении "Английское название" оказалась сводная информация, подготовленная Федерацией профсоюзов Свердловской области по данным членских организаций. Это значит, что ячейки ФПСО отзвонились в Екатеринбург и рассказали руководству региональной федерации, что происходит на местах. В той информации, которой мы обладаем, описана ситуация на 46 заводах, но в нее попали и самые крупные предприятия (НТМК, Уралмашзавод и т.д.). Главный вывод — ситуация критическая. На 12 предприятиях (25%) уже появилась задолженность по заработной плате, на 13 либо уже проведены, либо в январе-феврале 2009 года начнутся сокращения рабочих. Лишь единицы заводов не изменили графика работы, большинство же сократили и рабочую неделю, и рабочий день. Профсоюзы отмечают и нарушения: «Фанком» сократил раздел коллективного договора «Социальные гарантии», Уральская гидрогеологическая экспедиция не согласовала приказ об изменении режима рабочего времени с профкомом, на Буланашском машзаводе 51 человек уволен якобы по собственному желанию». \
Но самое неприятное впереди — с января предприятия-гиганты обещают сократить средний размер заработной платы. Где-то (СУМЗ) на 27%, где-то на 90% (СинТЗ). Не будем обобщать — данные по самым большим заводам и случаи наибольшего сокращения указаны в приведенной ниже таблице. Сделать выводы и прогнозы каждый сможет самостоятельно.'

news2 = 'В понедельник 28 июня у здания мэрии Москвы на Тверской площади состоялась очередная несанкционированная акция протеста «День гнева», в этот раз направленная, главным образом, против политики московских и подмосковных властей. Среди требований, выдвигаемых организаторами акции: «немедленная отставка мэра Москвы Юрия Лужкова, расследование итогов его деятельности», «созыв московского общественного форума для обсуждения путей реформирования основных сфер жизнедеятельности в Москве», «восстановление прямых выборов глав регионов России», «роспуск нелегитимной Мосгордумы», отставка подмосковного губернатора Бориса Громова и др. Участникам акции предлагалось принести с собой лист бумаги или кусок ткани чёрного цвета, символизирующие «чёрную метку» для Юрия Лужкова.\
Начало акции было намечено на 19 часов; подчёркивалось, что она состоится несмотря на запрет властей. Освещающие акцию блоггеры сообщили, что автобусы с милицией стали занимать площадь у памятника Юрию Долгорукому ещё с 15 часов дня, центральная часть площади была огорожена. Ко времени начала акции вокруг огороженной территории собралось множество журналистов и прохожих, по мере прибытия самих участников акции милиция начала планомерно их задерживать и заталкивать в автобусы. \
Всего, по сообщениям блоггеров и СМИ, было задержано более 30 человек. Пользователь ЖЖ zyalt сообщает, что среди задержанных оказался депутат муниципального собрания района Отрадное, сопредседатель московского отделения движения «Солидарность» Михаил Вельмакин, известный правозащитник Лев Пономарев, координатор движения «Левый фронт» Сергей Удальцов. \
Организаторами акции выступили движение «За права человека», Союз координационных советов (СКС), институт «Коллективное действие», «Жилищная солидарность», Движение общежитий Москвы, Движение в защиту Химкинского леса, движение «Московский совет», «Координационный совет пострадавших соинвесторов».'

```

Получение лемматизированных токенов из текстов


```python
tokens1 = preprocess_text(news1)  #  функция preprocess_text к переменной news1, чтобы получить множество лемматизированных токенов.
tokens2 = preprocess_text(news2)  #  аналогично для второго текста

```


```python
tokens1 # вывод для первого текста
```




    {'акциз',
     'алексей',
     'амортизационный',
     'английский',
     'анонсировать',
     'банк',
     'банковский',
     'близкий',
     'больший',
     'большинство',
     'буланашский',
     'булат',
     'быть',
     'бюджет',
     'бюджетный',
     'ведомость',
     'вица',
     'власть',
     'внести',
     'восстановление',
     'впереди',
     'время',
     'всё',
     'вывод',
     'выпадать',
     'вырасти',
     'вычет',
     'гарантия',
     'гигант',
     'гидрогеологический',
     'главный',
     'глубина',
     'говорить',
     'говориться',
     'год',
     'горючий',
     'госдума',
     'графика',
     'группа',
     'губернатор',
     'далее',
     'данные',
     'дать',
     'день',
     'директор',
     'договор',
     'доля',
     'допускать',
     'достигнуть',
     'доход',
     'доходный',
     'дых',
     'единица',
     'екатеринбург',
     'екатеринбургский',
     'желание',
     'завод',
     'задолженность',
     'законодательство',
     'законопроект',
     'записка',
     'заработный',
     'значит',
     'изменение',
     'изменить',
     'иметь',
     'имущественный',
     'иначе',
     'иной',
     'институт',
     'информация',
     'й',
     'каждый',
     'картина',
     'касаться',
     'квартира',
     'кодекс',
     'коллективный',
     'конец',
     'который',
     'край',
     'кредит',
     'кризис',
     'критический',
     'кроме',
     'крупный',
     'кто',
     'кудрин',
     'либо',
     'лицо',
     'лишь',
     'материал',
     'машзавод',
     'место',
     'металлургический',
     'минфин',
     'млн',
     'млрд',
     'моментально',
     'мочь',
     'название',
     'налог',
     'налоговый',
     'нарушение',
     'начаться',
     'ндс',
     'неделя',
     'неладный',
     'непонятный',
     'неприятный',
     'нести',
     'ниже',
     'нововведение',
     'новый',
     'ноябрьский',
     'нтмк',
     'обещать',
     'обладать',
     'область',
     'обобщать',
     'общий',
     'однако',
     'оказаться',
     'около',
     'олег',
     'описать',
     'организация',
     'отзвониться',
     'отлично',
     'отметить',
     'отмечать',
     'охватить',
     'пакет',
     'передавать',
     'передать',
     'передача',
     'переждать',
     'пересмотреть',
     'перетерпеть',
     'пермский',
     'плата',
     'плохой',
     'подготовить',
     'поддерживать',
     'подоходный',
     'подход',
     'покупка',
     'политика',
     'половина',
     'помощь',
     'попасть',
     'пополнить',
     'поправка',
     'поступление',
     'потеря',
     'потерять',
     'почувствовать',
     'появиться',
     'пояснительный',
     'правительство',
     'праздник',
     'предельный',
     'предкризисный',
     'предоставлять',
     'предприятие',
     'премия',
     'премьер',
     'прибыль',
     'привести',
     'признать',
     'приказ',
     'проблема',
     'провести',
     'прогноз',
     'продлить',
     'происходить',
     'промышленный',
     'простой',
     'профком',
     'профсоюз',
     'профсоюзный',
     'публиковать',
     'работа',
     'рабочий',
     'раздел',
     'размер',
     'разрешать',
     'район',
     'ранний',
     'распоряжение',
     'рассказать',
     'реальный',
     'регион',
     'региональный',
     'режим',
     'российский',
     'рубль',
     'руководство',
     'сайт',
     'самостоятельно',
     'самый',
     'свердловский',
     'сводный',
     'свой',
     'связь',
     'сделать',
     'сегодняшний',
     'сенсационный',
     'серьёзный',
     'синтз',
     'ситуация',
     'следовать',
     'следующий',
     'случай',
     'смазочный',
     'смочь',
     'снижение',
     'снизить',
     'снизиться',
     'собственный',
     'советовать',
     'согласовать',
     'сократить',
     'сокращение',
     'сообщить',
     'соответственно',
     'составить',
     'сохранить',
     'социальный',
     'среднее',
     'средний',
     'средство',
     'стараться',
     'стоимость',
     'стоить',
     'столяров',
     'страдать',
     'сумза',
     'сумма',
     'таблица',
     'так',
     'такой',
     'тот',
     'трлн',
     'тяжёлый',
     'увеличение',
     'уволить',
     'угмк',
     'ударить',
     'указать',
     'управленец',
     'урал',
     'уралмашзавод',
     'уральский',
     'уровень',
     'фанк',
     'февраль',
     'федеральный',
     'федерация',
     'физически',
     'финансы',
     'фпсо',
     'хватить',
     'целое',
     'часть',
     'человек',
     'чиркун',
     'членский',
     'экономический',
     'экспедиция',
     'это',
     'этот',
     'якобы',
     'январь',
     'ячейка'}




```python
tokens2 # вывод для второго текста
```




    {'автобус',
     'акция',
     'блогер',
     'борис',
     'бумага',
     'вельмакина',
     'власть',
     'вокруг',
     'восстановление',
     'время',
     'выборы',
     'выдвигать',
     'выступить',
     'глава',
     'главный',
     'гнев',
     'громов',
     'губернатор',
     'движение',
     'действие',
     'день',
     'депутат',
     'деятельность',
     'долгорукий',
     'др',
     'ещё',
     'жж',
     'жизнедеятельность',
     'жилищный',
     'журналист',
     'задержать',
     'задерживать',
     'занимать',
     'запрет',
     'заталкивать',
     'защита',
     'здание',
     'известный',
     'институт',
     'итог',
     'июнь',
     'к',
     'коллективный',
     'координатор',
     'координационный',
     'кусок',
     'лев',
     'левый',
     'лес',
     'лист',
     'лужков',
     'мера',
     'метка',
     'милиция',
     'михаил',
     'множество',
     'мосгордума',
     'москва',
     'московский',
     'муниципальный',
     'мэр',
     'мэрия',
     'наметить',
     'направить',
     'начало',
     'нелегитимный',
     'немедленный',
     'несанкционированный',
     'несмотря',
     'образ',
     'обсуждение',
     'общежитие',
     'общественный',
     'огородить',
     'оказаться',
     'организатор',
     'освещать',
     'основный',
     'отделение',
     'отрадный',
     'отставка',
     'очередной',
     'памятник',
     'планомерно',
     'площадь',
     'подмосковный',
     'подчёркиваться',
     'политика',
     'пользователь',
     'понедельник',
     'пономарёв',
     'пострадать',
     'право',
     'правозащитник',
     'предлагаться',
     'прибытие',
     'принести',
     'протест',
     'против',
     'прохожий',
     'прямой',
     'путь',
     'район',
     'расследование',
     'регион',
     'реформирование',
     'роспуск',
     'россия',
     'сам',
     'себя',
     'сергей',
     'символизировать',
     'скс',
     'сми',
     'собрание',
     'собраться',
     'совет',
     'созыв',
     'соинвестор',
     'солидарность',
     'сообщать',
     'сообщение',
     'сообщить',
     'сопредседатель',
     'состояться',
     'союз',
     'среди',
     'стать',
     'сфера',
     'тверской',
     'территория',
     'ткань',
     'требование',
     'удальцов',
     'участник',
     'форум',
     'фронт',
     'химкинский',
     'цвет',
     'центральный',
     'час',
     'часть',
     'человек',
     'чёрный',
     'юрий'}



Лемматизация и подсчет частоты слов в тексте


```python
from collections import Counter  # класс Counter для подсчета частоты элементов

def bag_of_words(text):  # функция bag_of_words, принимающую текст в качестве аргумента
    morph = pymorphy2.MorphAnalyzer()  # экземпляр морфологического анализатора для лемматизации слов

    text = text.lower()  # нужно привести текст к нижнему регистру для устранения различий в регистре

    text = re.sub(r'[^а-яё]', ' ', text)  # нужно заменить все символы, кроме русских букв, на пробелы

    words = text.split()  # разбиваем текст на отдельные слова и удаляем лишние пробелы

    lemmatized_words = [  # создаю список лемматизированных слов
        morph.normal_forms(word)[0] for word in words  # Лемматизирую каждое слово
        if word not in russian_stopwords and word.isalpha()  # Фильтрую стоп-слова и неалфавитные строки
    ]

    word_count = Counter(lemmatized_words)  # Подсчитываю частоту вхождений лемматизированных слов
    return dict(word_count)  # Возврат результата в виде словаря

```

Term Frequency


```python
def compute_tf(word_count, total_words):  # функция compute_tf, которая принимает словарь с количеством слов и общим количеством слов
    tf_dict = {}  # пустой словарь для хранения значений Term Frequency

    for word, count in word_count.items():
        tf_dict[word] = count / total_words  # вычисляется TF для каждого слова и сохраняется в список tf_dict

    return tf_dict  # Возврат словаря с TF для каждого слова

```

Inverse Document Frequency


```python
import math  # модуль math для математических операций

def compute_idf(documents):
    idf_dict = {}  # пустой словарь для хранения значений IDF
    total_documents = len(documents)  # общее количество документов

    for document in documents:  # цикл по каждому документу в списке
        for word in set(document.keys()):  # цикл по уникальным словам в документе
            if word not in idf_dict:  # Если слово еще не добавлено в idf_dict
                idf_dict[word] = 0  # Инициализируется счетчик для этого слова
            idf_dict[word] += 1  # Увеличивается счетчик на 1

    for word, count in idf_dict.items():  # цикл по каждому слову и его счетчику
        idf_dict[word] = math.log(total_documents / count)  # IDF с использованием логарифма

    return idf_dict  # Возврат словаря с IDF для каждого слова

```

IDF


```python
def compute_tfidf(documents):  # функция compute_tfidf для списка документов
    tfidf_scores = []  # список для хранения TF-IDF значений для каждого документа

    tf_list = [compute_tf(doc, sum(doc.values())) for doc in documents]  # Для каждого документа вычисляется TF и сохраняется в tf_list

    idf_scores = compute_idf(documents)  # Вычисляем IDF для оригинальных документов

    for tf in tf_list:  # цикл по каждому словарю TF в tf_list
        tfidf_doc = {}  #  словарь для хранения TF-IDF значений для текущего документа
        for word, tf_value in tf.items():  # цикл по каждому слову и его TF значению
            tfidf_doc[word] = tf_value * idf_scores[word]  # подсчет TF-IDF и добавление его в словарь
        tfidf_scores.append(tfidf_doc)  # Добавление словаря TF-IDF текущего документа в общий список

    return tfidf_scores  # Возврат списка TF-IDF значений для всех документов

```

Извлечение ключевых слов из текстов с использованием TF-IDF


```python
bag_of_words1 = bag_of_words(news1)  # функция bag_of_words к первому тексту
bag_of_words2 = bag_of_words(news2)  # аналогично для второго текста

documents = [bag_of_words1, bag_of_words2]  # Сбор слов в список документов
tfidf_results = compute_tfidf(documents)  # TF-IDF для списка документов

for i, tfidf in enumerate(tfidf_results):  # циклпо  результатам TF-IDF
    print(f"Ключевые слова для текста {i + 1}:")  # Вывод номера текста

    sorted_keywords = sorted(tfidf.items(), key=lambda item: item[1], reverse=True)[:6]  # Сортировкаслова по значению TF-IDF и взяли 6 наибольших
    for word, score in sorted_keywords:  # цикл отсортированных ключевых слова
        print(f"{word}: {score}")  # Вывод слова и его значения TF-IDF
    print(' ')

```

    Ключевые слова для текста 1:
    предприятие: 0.013828372679500154
    рубль: 0.010371279509625117
    налог: 0.010371279509625117
    прибыль: 0.010371279509625117
    ситуация: 0.010371279509625117
    кризис: 0.008642732924687598
     
    Ключевые слова для текста 2:
    акция: 0.029185144444629274
    движение: 0.021888858333471956
    москва: 0.014592572222314637
    московский: 0.014592572222314637
    площадь: 0.010944429166735978
    юрий: 0.010944429166735978
     
    
